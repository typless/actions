name: 'Code quality'
description: 'Checking code quality'
inputs:
  python-version:
    description: Input python version
    required: true
  poetry-version:
    description: Input poetry version
    required: false
    default: "latest"
  aws-pypi-username:
    description: Input aws username to access aws pypi bucket
    required: true
  aws-pypi-password:
    description: Input aws password to access aws pypi bucket
    required: true
  working-directory:
    description: Input working directory
    required: true

runs:
  using: composite
  steps:
    - name: Install python dependencies
      uses: typless/actions/install-python-dependencies@v3.0
      with:
        python-version: ${{ inputs.python-version }}
        poetry-version: ${{ inputs.poetry-version }}
        aws-pypi-username: ${{ inputs.aws-pypi-username }}
        aws-pypi-password: ${{ inputs.aws-pypi-password }}
        working-directory: ${{ inputs.working-directory }}
    - name: Run black
      shell: bash
      run: poetry run black . --check
      working-directory:  ${{ inputs.working-directory }}
    - name: Run isort
      shell: bash
      run: poetry run isort . --check-only --profile black
      working-directory:  ${{ inputs.working-directory }}
    - name: Run flake8
      shell: bash
      run: poetry run flake8 .
      working-directory:  ${{ inputs.working-directory }}
    - name: Run bandit
      shell: bash
      run: poetry run bandit .
      working-directory:  ${{ inputs.working-directory }}
    - name: Run safety check
      shell: bash
      run: poetry run safety check || true
      working-directory:  ${{ inputs.working-directory }}
